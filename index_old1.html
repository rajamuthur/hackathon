<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
		<title>Mangathada</title>
		<link rel="stylesheet" href="css/style.css" />
		<link rel="apple-touch-icon-precomposed" sizes="144x144" href="icon.png">
		<link rel="apple-touch-icon-precomposed" sizes="114x114" href="icon.png">
		<link rel="apple-touch-icon-precomposed" sizes="72x72" href="icon.png">
		<link rel="apple-touch-icon-precomposed" href="icon.png">
		<link rel="shortcut icon" href="icon.png">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="description" content="Card game written in HTML/CSS/JS">
		<link rel="stylesheet" type="text/css" href="css/optional.css">
		<style type="text/css">
			/* Recommended styles */

			.drag, .drag2 {
				float: left;
				width: 21%;
				background-color: Green;
				color: white;
				margin: 10px 2%;
				cursor: move;
				text-align: center;
				-moz-border-radius: 1em;
				-webkit-border-radius: 1em;
				border-radius: 1em;
			}

			.selected {
				background-color: Yellow;
				color: Black;
			}

			.drop {
				background-color: Blue;
				color: White;
				margin: 3px;
				padding: 10px;
				-moz-border-radius: 1em;
				-webkit-border-radius: 1em;
				border-radius: 1em;
			}

			.active {
				background-color: orange;
				cursor: crosshair;
			}
			.getDetails{
				clear: both;
				text-align:center;
			}
		</style>
	</head>
	<body onresize="resize()">
<!--				<div class="drop" id="drop1">
					<div style="clear: both;"><p>You can drop items here.</p></div>
				</div>-->
				<div class="drop" id="drop2">
					<div style="clear: both;"><p>You can drop items here too.</p></div>
				</div>
<!--				<div class="drag" id="drag1">
					<p>Drag 1</p>
				</div>
				<div class="drag" id="drag2">
					<p>Drag 2</p>
				</div>
				<div class="drag" id="drag3">
					<p>Drag 3</p>
				</div>-->
				<div class="drag2" id="drag2">
					<p>Drag 4*</p>
				</div>
				<div class="drag2" id="drag3">
					<p>Drag 4*</p>
				</div>
				<div class="drag2" id="drag4">
					<p>Drag 4*</p>
				</div>

		<div class="getDetails" style="padding-top:40px">
			<label > Username</label>
			<input type="text" value="" name="username" id="username" />
			<input type="button" value="get_click" name="get_click" id="get_click"/>
			<input type="button" value="post_click" name="post_click" id="post_click"/>
			<input type="button" value="get" name="get" id="get"/>
			<input type="button" value="post" name="post" id="post"/>
			<input type="button" value="get_touch" name="get_touch" id="get_touch"/>
			<input type="button" value="post_touch" name="post_touch" id="post_touch"/>
		</div>
		<div id="container" class="container playingCards"></div>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script type="text/javascript" src="js/jquery.mobiledragdrop.js"></script>
		<script type="text/javascript">
			$("#post").bind('touchstart click', function () {
				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'POST',
					url: 'http://10.100.103.19:3333/addPlayer',
					data: {foo:'this is post method'},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			
			$("#get").bind('touchstart click', function () {

				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'GET',
					url: 'http://10.100.103.19:3333/getPlayers',
					data: {},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			$("#post_click").bind('click', function () {
				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'POST',
					url: 'http://10.100.103.19:3333/addPlayer',
					data: {foo:'this is post method'},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			
			$("#get_click").bind('click', function () {

				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'GET',
					url: 'http://10.100.103.19:3333/getPlayers',
					data: {},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			$("#post_touch").bind('touchstart', function () {
				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'POST',
					url: 'http://10.100.103.19:3333/addPlayer',
					data: {foo:'this is post method'},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			
			$("#get_touch").bind('touchstart', function () {

				var params = {};
				params.username = 'raja';
				$.ajax({
					type: 'GET',
					url: 'http://10.100.103.19:3333/getPlayers',
					data: {},
					dataType: 'json',
					crossDomain:true,
					success: submitUserSuccess,
					failure: submitUserFailure,
					postback: {}
				});
			});
			
//			$("#post1").bind('touchstart click', function () {
//				var params = {};
//				params.username = 'raja';
//				$.ajax({
//					type: 'POST',
//					url: 'http://10.100.103.19:3333/addPlayer',
//					data: {'foo':"this is post method"},
//					dataType: 'jsonp',
//					crossDomain:true,
//					success: submitUserSuccess,
//					failure: submitUserFailure,
//					postback: {}
//				});
//			});
//			
//			$("#get1").bind('touchstart click', function () {
//				var contentType ="application/x-www-form-urlencoded; charset=utf-8";
//
//				var params = {};
//				params.username = 'raja';
//				$.ajax({
//					type: 'GET',
//					url: 'http://10.100.103.19:3333/getPlayers',
//					data: {},
//					dataType: 'jsonp',
//					crossDomain:true,
//					success: submitUserSuccess,
//					failure: submitUserFailure,
//					postback: {}
//				});
//			});


			function submitUserSuccess(data, postback)
			{
				var res = data;
				alert("submitUserSuccess");
				alert(res.foo);
				createPlayer(input);
			}
			function submitUserFailure(data, postback)
			{
				console.log("dd");
				alert("submitUserFailure");
				alert(data);
			}
			$(document).ready(function () {
				$(".drag").mobiledraganddrop({targets: "#drop1", status: "#status"});
				$(".drag2").mobiledraganddrop({targets: "#drop2", status: "#status"});
				$(".drag3").mobiledraganddrop({targets: "#drop3", status: "#status"});
			});
		</script>
		<script type="text/javascript" src="js/init.js"></script>
		<script type="text/javascript">
			// Example input json
			var input = {
				"totalplayer": 4,
				"game_id": "1",
				"group_id": "1",
				"active_player_id": "1_1",
				"players":
						{
							"0":
									{
										"cards_count": 3,
										"show_all_cards": true,
										"show_first_card": true,
										"cards_list": ["7_diams", "5_clubs", "3_diams"],
										"player_name": "Mr X",
										"next_to_play": true,
										"is_active_player": true,
										"player_id": "1_1",
										"position": 1,
										"class": "bottomplayer",
										"gender": 'women'
									},
							"1":
									{
										"cards_count": 5,
										"show_all_cards": false,
										"show_first_card": false,
										"cards_list": ["5_clubs", "2_clubs", "6_diams", "1_clubs", "9_clubs"],
										"player_name": "Mr Y",
										"next_to_play": false,
										"is_active_player": false,
										"player_id": "2_1",
										"position": 2,
										"class": "leftplayer",
										"gender": 'men'
									},
							"2":
									{
										"cards_count": 6,
										"show_all_cards": false,
										"show_first_card": true,
										"cards_list": ["6_diams", "2_diams", "6_diams", "1_clubs", "9_clubs", "9_diams"],
										"player_name": "Mr Z",
										"next_to_play": false,
										"is_active_player": false,
										"player_id": "3_1",
										"position": 3,
										"class": "topplayer",
										"gender": 'women'
									},
							"3":
									{
										"cards_count": 1,
										"show_all_cards": false,
										"show_first_card": false,
										"cards_list": ["7_spades"],
										"player_name": "Mr A",
										"next_to_play": false,
										"is_active_player": false,
										"player_id": "4_1",
										"position": 4,
										"class": "rightplayer",
										"gender": 'women'
									}
						},
				"bank":
						{
							"cards_count": 4,
							"show_all_cards": true,
							"show_first_card": false,
							"cards_list": ["5_clubs", "5_clubs", "1_clubs", "2_spades"],
							"player_name": "Mr Bank",
							"next_to_play": false,
							"is_active_player": false,
							"player_id": "",
							"class": "centerplayer",
							"gender": 'bank'
						}
			};

			function createContainer() {

			}

			function createPlayer(input) {
				console.log("createPlayer");
				console.log(input);
				var output = '<div id="container" class="container playingCards">';
				var len = input.totalplayer;
				var activePlayerId = input.active_player_id;
				console.log("len: " + len);
				console.log("activePlayerId: " + activePlayerId);
				for (var i = 0; i < len; i++)
				{
					console.log(input["players"][i]);
					var playerId = input["players"][i].player_id;
					var playerCls = input["players"][i].class;
					playerCls += (playerId == activePlayerId) ? '' : '';
					console.log("playerCls: " + playerCls);
					console.log("playerId: " + playerId);
					output += '<div class="' + playerCls + '">';
					output += '<div class="' + playerCls + 'details">';
					output += '<img src="img/men.png" title="player"/>';
					output += cardsSet(input["players"][i]);
					output += '</div>';
					output += '</div>';
				}

				console.log(input["bank"]);
				output += createCenterDiv(input["bank"]);
				output += '</div>';
				console.log('Output: ' + output);
				console.log(document.getElementById("container"));
				document.getElementById("container").innerHTML = output;
				return output;
			}

			function createCenterDiv(input) {
				console.log("createCenterDiv input");
				console.log(input);
				var playerCls = input.class;
				var output = '';
				output += '<div class="' + playerCls + '">';
				output += '<div class="' + playerCls + 'details gradient-pattern" id="drag3">';
				output += '<img src="img/' + input.gender + '.png" title="player"/>';
				output += cardsSet(input);
				output += getDeckofCards(10);
				output += '</div>';
				output += '</div>';
				console.log("cardsset output");
				console.log(output);
				return output;
			}

			function getDeckofCards(cardscount) {
				var output = '';
				output += '<ul class="deck">';
				for (var i = 0; i < cardscount; i++)
				{
					output += '<li>';
					output += '<div class="card back">*</div>';
					output += '</li>';
				}
				return output += '</ul>';
			}

			function cardsSet(input) {
				console.log("cardsset input");
				console.log(input);
				var output = '';
				console.log(input);
				var cardSet = input.cards_list;
				var len = input.cards_count;
				var sac = input.show_all_cards;
				var sfc = input.show_first_card;
				output += '<ul class="hand">';
				var cls;
				for (var i = 0; i < len; i++)
				{
					var cardArr = cardSet[i].split('_');
					output += '<li>';
					var cardname = '<span class="rank">' + cardArr[0] + '</span>';
					var suit = cardArr[1] == 'diams' ? '♦' : (cardArr[1] == 'hearts' ? '♥' : (cardArr[1] == 'clubs' ? '♣' : '♠'));
					cardname += '<span class="suit">' + suit + '</span>';
					if (i == 0 && sac == true && sfc == true) {
						cls = 'drag3 card rank-' + cardArr[0] + ' ' + cardArr[1];
					} else if (i > 0 && sac == true) {
						cls = 'drag3 card rank-' + cardArr[0] + ' ' + cardArr[1];
					} else {
						cls = 'drag3 card back';
						cardname = '';
					}
					output += '<a href="#" class="' + cls + '">';
					output += cardname;
					output += '</a>';
					output += '</li>';
				}

				output += '</ul>';
				console.log("cardsset output");
				console.log(output);
				return output;

			}

		</script>


	</body>
</html>